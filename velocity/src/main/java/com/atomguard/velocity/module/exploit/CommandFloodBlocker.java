package com.atomguard.velocity.module.exploit;

import com.atomguard.velocity.module.antiddos.RateLimiter;

import java.util.UUID;

/**
 * Komut flood engelleme.
 */
public class CommandFloodBlocker {

    private final RateLimiter rateLimiter;

    public CommandFloodBlocker(int maxCommandsPerSecond) {
        this.rateLimiter = new RateLimiter(maxCommandsPerSecond * 2, maxCommandsPerSecond);
    }

    public boolean allowCommand(UUID playerId, String command) {
        // Bazı komutlar özel limit gerektiriyor
        int tokens = command.startsWith("login") || command.startsWith("register") ? 2 : 1;
        return rateLimiter.tryAcquire(playerId.toString(), tokens);
    }

    public void reset(UUID playerId) { rateLimiter.reset(playerId.toString()); }
    public void cleanup() { rateLimiter.cleanup(); }
}
