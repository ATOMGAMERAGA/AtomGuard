name: Release

on:
  push:
    tags:
      - "v*"

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      discussions: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Java 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: 'maven'

      - name: Build with Maven
        run: mvn clean package -DskipTests

      - name: Generate Checksums
        run: |
          find core/target api/target velocity/target -name "AtomGuard-*.jar" -not -name "*-sources*" -not -name "*-original*" -exec sha256sum {} + > SHA256SUMS

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            core/target/AtomGuard-core-*.jar
            velocity/target/AtomGuard-velocity-*.jar
            api/target/AtomGuard-api-*.jar
            SHA256SUMS
          generate_release_notes: true
          draft: false
          prerelease: false
          name: AtomGuard ${{ github.ref_name }}
          body: |
            ## üõ°Ô∏è AtomGuard ${{ github.ref_name }}

            Advanced Minecraft Server Security & Exploit Protection.

            ### üì¶ Installation
            1. Stop your server.
            2. Delete any old `AtomGuard` or `AtomSMPFixer` JARs from the plugins folder.
            3. Upload the new `AtomGuard-core-${{ github.ref_name }}.jar` to your Paper server's plugins folder.
            4. (Optional) Upload `AtomGuard-velocity-${{ github.ref_name }}.jar` to your Velocity proxy's plugins folder.
            5. Start your server.

            ### üì¶ Files
            | File | Description |
            |------|-------------|
            | `AtomGuard-core-*.jar` | Paper/Spigot server plugin |
            | `AtomGuard-velocity-*.jar` | Velocity proxy plugin |
            | `AtomGuard-api-*.jar` | Developer API (for third-party integrations) |
            | `SHA256SUMS` | SHA-256 checksums for verification |

            ### üîê Checksums (SHA-256)
            See `SHA256SUMS` file for verification.

            ---
            *Made with ‚ù§Ô∏è by AtomGuard Team*