name: Release

on:
  push:
    tags:
      - "v*"

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      discussions: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Java 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: 'maven'

      - name: Build with Maven
        run: mvn clean package -DskipTests

      - name: Generate Checksums
        run: |
          find core/target velocity/target -name "AtomGuard-*.jar" -not -name "*-sources*" -exec sha256sum {} + > SHA256SUMS

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          files: |
            core/target/AtomGuard-core-*.jar
            velocity/target/AtomGuard-velocity-*.jar
            SHA256SUMS
          generate_release_notes: true
          draft: false
          prerelease: false
          name: Atom Guard ${{ github.ref_name }}
          body: |
            ## üõ°Ô∏è Atom Guard ${{ github.ref_name }}
            
            Advanced Minecraft Server Security & Exploit Protection.
            
            ### üì¶ Installation
            1. Stop your server.
            2. Delete any old `AtomGuard` or `AtomSMPFixer` JARs from the plugins folder.
            3. Upload the new `AtomGuard-${{ github.ref_name }}.jar`.
            4. Start your server.
            
            ### üîê Checksums (SHA-256)
            See `SHA256SUMS` file for verification.
            
            ---
            *Made with ‚ù§Ô∏è by AtomGuard Team Team*